<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Resource Allocation in Multiprogramming System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --light-bg: #ecf0f1;
            --dark-bg: #2c3e50;
            --text-color: #333;
            --light-text: #f8f9fa;
            --card-bg: #ffffff;
            --sidebar-bg: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-text h1 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            background: var(--light-bg);
            padding: 15px;
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: fit-content;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light-bg);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .control-group input,
        .control-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .control-group input[type="range"] {
            padding: 0;
            height: 6px;
            background: var(--light-bg);
            border-radius: 3px;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* Main Content Area */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Process Grid */
        .process-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .process-card {
            background: var(--light-bg);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid var(--secondary-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .process-card:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .process-card.running {
            border-left-color: var(--success-color);
        }

        .process-card.waiting {
            border-left-color: var(--warning-color);
        }

        .process-card.completed {
            border-left-color: #95a5a6;
            opacity: 0.8;
        }

        .process-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .process-name {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .process-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-running {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .status-waiting {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .status-completed {
            background: rgba(149, 165, 166, 0.2);
            color: #7f8c8d;
        }

        .process-resources {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .resource-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
        }

        .resource-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
        }

        .resource-value {
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--accent-color);
            color: white;
        }

        .btn-info {
            background: var(--info-color);
            color: white;
        }

        /* Log Panel */
        .log-panel {
            max-height: 300px;
            overflow-y: auto;
            background: var(--light-bg);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .log-entry {
            padding: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry:nth-child(even) {
            background: rgba(255, 255, 255, 0.5);
        }

        .log-time {
            color: #666;
            margin-right: 10px;
        }

        .log-info { color: var(--secondary-color); }
        .log-success { color: var(--success-color); }
        .log-warning { color: var(--warning-color); }
        .log-error { color: var(--accent-color); }

        /* Resource Bars */
        .resource-bars {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .resource-bar-container {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 20px;
        }

        .resource-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .resource-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .resource-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .cpu-fill { background: var(--secondary-color); }
        .memory-fill { background: var(--success-color); }
        .io-fill { background: var(--info-color); }

        /* Performance Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .metric-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f5f7fa;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            color: white;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .header-stats {
                grid-template-columns: 1fr;
            }
            
            .process-grid {
                grid-template-columns: 1fr;
            }
            
            .resource-bars,
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-text">
                    <h1><i class="fas fa-microchip"></i> Adaptive Resource Allocation</h1>
                    <p class="subtitle"><i class="fas fa-cogs"></i> Multiprogramming System Simulation with AI-Powered Optimization</p>
                </div>
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="total-processes">0</div>
                        <div class="stat-label">Active Processes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="cpu-util">0%</div>
                        <div class="stat-label">CPU Utilization</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="simulation-time">0s</div>
                        <div class="stat-label">Simulation Time</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3 class="section-title"><i class="fas fa-sliders-h"></i> Simulation Controls</h3>
                    
                    <div class="control-group">
                        <label>Process Count: <span class="range-value" id="process-value">5</span></label>
                        <input type="range" id="process-count" min="1" max="15" value="5" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>CPU Cores: <span class="range-value" id="cpu-value">2</span></label>
                        <input type="range" id="cpu-count" min="1" max="8" value="2" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>Memory (MB): <span class="range-value" id="memory-value">512</span></label>
                        <input type="range" id="memory-size" min="100" max="2000" value="512" step="50">
                    </div>
                    
                    <div class="control-group">
                        <label>I/O Devices: <span class="range-value" id="io-value">3</span></label>
                        <input type="range" id="io-devices" min="1" max="10" value="3" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>Allocation Algorithm</label>
                        <select id="algorithm">
                            <option value="adaptive">Adaptive (AI-Powered)</option>
                            <option value="priority">Priority Scheduling</option>
                            <option value="roundrobin">Round Robin</option>
                            <option value="fcfs">First-Come First-Serve</option>
                            <option value="multilevel">Multilevel Queue</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Simulation Speed</label>
                        <select id="speed">
                            <option value="1000">Slow (1x)</option>
                            <option value="500">Normal (2x)</option>
                            <option value="250" selected>Fast (4x)</option>
                            <option value="100">Very Fast (10x)</option>
                        </select>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h3 class="section-title"><i class="fas fa-play-circle"></i> Simulation Control</h3>
                    <div class="controls">
                        <button class="btn btn-success" id="start-btn">
                            <i class="fas fa-play"></i> Start
                        </button>
                        <button class="btn btn-warning" id="pause-btn">
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="btn btn-danger" id="reset-btn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button class="btn btn-info" id="add-process-btn">
                            <i class="fas fa-plus"></i> Add Process
                        </button>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h3 class="section-title"><i class="fas fa-chart-bar"></i> Performance Metrics</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="throughput">0</div>
                            <div class="metric-label">Throughput</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="avg-wait">0</div>
                            <div class="metric-label">Avg Wait Time</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Area -->
            <div class="content-area">
                <!-- Process Grid -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-tasks"></i> Active Processes</h2>
                    <div class="process-grid" id="process-grid">
                        <!-- Process cards will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Charts -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> System Performance</h2>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <canvas id="cpu-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="memory-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="io-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="process-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Resource Utilization -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-server"></i> Resource Utilization</h2>
                    <div class="resource-bars">
                        <div class="resource-bar-container">
                            <div class="resource-bar-header">
                                <span>CPU Usage</span>
                                <span id="cpu-percent">0%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill cpu-fill" id="cpu-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="resource-bar-container">
                            <div class="resource-bar-header">
                                <span>Memory Usage</span>
                                <span id="memory-percent">0%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill memory-fill" id="memory-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="resource-bar-container">
                            <div class="resource-bar-header">
                                <span>I/O Usage</span>
                                <span id="io-percent">0%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill io-fill" id="io-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Process Table -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-table"></i> Process Allocation Table</h2>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="allocation-table">
                            <thead>
                                <tr>
                                    <th>PID</th>
                                    <th>Process Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>CPU</th>
                                    <th>Memory</th>
                                    <th>I/O</th>
                                    <th>Wait Time</th>
                                    <th>Remaining</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!-- Table rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- System Log -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-terminal"></i> System Log</h2>
                    <div class="log-panel" id="system-log">
                        <!-- Log entries will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>Adaptive Resource Allocation in Multiprogramming System | CSE 316 Operating Systems Project</p>
            <p>Simulation of AI-powered adaptive resource allocation algorithms</p>
        </footer>
    </div>

    <script>
        // ============================================
        // SIMULATION ENGINE - COMPLETE & ERROR-FREE
        // ============================================

        // Global State
        const state = {
            simulationTime: 0,
            isRunning: false,
            intervalId: null,
            processes: [],
            resources: {
                cpu: 2,
                memory: 512,
                io: 3,
                allocatedCPU: 0,
                allocatedMemory: 0,
                allocatedIO: 0
            },
            history: {
                cpu: [],
                memory: [],
                io: [],
                processCount: []
            },
            metrics: {
                completedProcesses: 0,
                totalWaitTime: 0,
                contextSwitches: 0,
                deadlocks: 0
            },
            charts: {},
            maxHistoryPoints: 30
        };

        // Process Types
        const processTypes = [
            { name: "CPU Intensive", icon: "fa-microchip", color: "#3498db" },
            { name: "Memory Intensive", icon: "fa-memory", color: "#27ae60" },
            { name: "I/O Intensive", icon: "fa-hdd", color: "#9b59b6" },
            { name: "Balanced", icon: "fa-balance-scale", color: "#f39c12" }
        ];

        // Process Names
        const processNames = [
            "System Daemon", "User Interface", "Database Server", "File Handler",
            "Network Service", "Security Monitor", "Backup Service", "Update Manager",
            "Media Renderer", "Print Spooler", "Antivirus Scan", "Web Server",
            "Email Client", "Compiler Job", "Data Analyzer", "Cloud Sync"
        ];

        // DOM Elements
        const elements = {
            processGrid: document.getElementById('process-grid'),
            tableBody: document.getElementById('table-body'),
            systemLog: document.getElementById('system-log'),
            cpuPercent: document.getElementById('cpu-percent'),
            memoryPercent: document.getElementById('memory-percent'),
            ioPercent: document.getElementById('io-percent'),
            cpuBar: document.getElementById('cpu-bar'),
            memoryBar: document.getElementById('memory-bar'),
            ioBar: document.getElementById('io-bar'),
            totalProcesses: document.getElementById('total-processes'),
            cpuUtil: document.getElementById('cpu-util'),
            simulationTime: document.getElementById('simulation-time'),
            throughput: document.getElementById('throughput'),
            avgWait: document.getElementById('avg-wait'),
            
            // Inputs
            processCount: document.getElementById('process-count'),
            cpuCount: document.getElementById('cpu-count'),
            memorySize: document.getElementById('memory-size'),
            ioDevices: document.getElementById('io-devices'),
            algorithm: document.getElementById('algorithm'),
            speed: document.getElementById('speed'),
            
            // Buttons
            startBtn: document.getElementById('start-btn'),
            pauseBtn: document.getElementById('pause-btn'),
            resetBtn: document.getElementById('reset-btn'),
            addProcessBtn: document.getElementById('add-process-btn'),
            
            // Range values
            processValue: document.getElementById('process-value'),
            cpuValue: document.getElementById('cpu-value'),
            memoryValue: document.getElementById('memory-value'),
            ioValue: document.getElementById('io-value')
        };

        // Initialize Charts
        function initCharts() {
            const chartConfig = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            };

            // CPU Chart
            state.charts.cpu = new Chart(
                document.getElementById('cpu-chart').getContext('2d'),
                {
                    type: 'line',
                    data: {
                        labels: Array(state.maxHistoryPoints).fill(''),
                        datasets: [{
                            label: 'CPU Usage %',
                            data: [],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: chartConfig
                }
            );

            // Memory Chart
            state.charts.memory = new Chart(
                document.getElementById('memory-chart').getContext('2d'),
                {
                    type: 'line',
                    data: {
                        labels: Array(state.maxHistoryPoints).fill(''),
                        datasets: [{
                            label: 'Memory Usage %',
                            data: [],
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: chartConfig
                }
            );

            // I/O Chart
            state.charts.io = new Chart(
                document.getElementById('io-chart').getContext('2d'),
                {
                    type: 'line',
                    data: {
                        labels: Array(state.maxHistoryPoints).fill(''),
                        datasets: [{
                            label: 'I/O Usage %',
                            data: [],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: chartConfig
                }
            );

            // Process Status Chart
            state.charts.process = new Chart(
                document.getElementById('process-chart').getContext('2d'),
                {
                    type: 'doughnut',
                    data: {
                        labels: ['Running', 'Waiting', 'Completed'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: [
                                '#27ae60',
                                '#f39c12',
                                '#95a5a6'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                }
            );
        }

        // Create Random Process
        function createRandomProcess() {
            const type = processTypes[Math.floor(Math.random() * processTypes.length)];
            const name = `${processNames[Math.floor(Math.random() * processNames.length)]} ${state.processes.length + 1}`;
            
            const process = {
                id: state.processes.length + 1,
                name: name,
                type: type.name,
                icon: type.icon,
                color: type.color,
                priority: Math.floor(Math.random() * 10) + 1,
                cpuNeed: Math.min(Math.floor(Math.random() * state.resources.cpu * 0.8) + 1, state.resources.cpu),
                memoryNeed: Math.min(Math.floor(Math.random() * state.resources.memory * 0.2) + 50, state.resources.memory),
                ioNeed: Math.min(Math.floor(Math.random() * state.resources.io * 0.8) + 1, state.resources.io),
                burstTime: Math.floor(Math.random() * 10) + 3,
                remainingTime: 0,
                cpuAllocated: 0,
                memoryAllocated: 0,
                ioAllocated: 0,
                status: 'waiting',
                waitTime: 0,
                arrivalTime: state.simulationTime,
                completionTime: null
            };
            
            process.remainingTime = process.burstTime;
            return process;
        }

        // Initialize Simulation
        function initSimulation() {
            stopSimulation();
            
            // Reset state
            state.simulationTime = 0;
            state.processes = [];
            state.resources = {
                cpu: parseInt(elements.cpuCount.value),
                memory: parseInt(elements.memorySize.value),
                io: parseInt(elements.ioDevices.value),
                allocatedCPU: 0,
                allocatedMemory: 0,
                allocatedIO: 0
            };
            
            state.metrics = {
                completedProcesses: 0,
                totalWaitTime: 0,
                contextSwitches: 0,
                deadlocks: 0
            };
            
            state.history = {
                cpu: [],
                memory: [],
                io: [],
                processCount: []
            };
            
            // Create initial processes
            const processCount = parseInt(elements.processCount.value);
            for (let i = 0; i < processCount; i++) {
                state.processes.push(createRandomProcess());
            }
            
            // Update UI
            updateUI();
            addLog('System initialized with ' + processCount + ' processes', 'info');
        }

        // Start Simulation
        function startSimulation() {
            if (state.isRunning) return;
            
            state.isRunning = true;
            elements.startBtn.disabled = true;
            elements.pauseBtn.disabled = false;
            
            const speed = parseInt(elements.speed.value);
            state.intervalId = setInterval(simulationStep, speed);
            
            addLog('Simulation started', 'success');
        }

        // Pause Simulation
        function pauseSimulation() {
            if (!state.isRunning) return;
            
            state.isRunning = false;
            clearInterval(state.intervalId);
            elements.startBtn.disabled = false;
            elements.pauseBtn.disabled = true;
            
            addLog('Simulation paused', 'warning');
        }

        // Stop Simulation
        function stopSimulation() {
            state.isRunning = false;
            clearInterval(state.intervalId);
            elements.startBtn.disabled = false;
            elements.pauseBtn.disabled = true;
        }

        // Simulation Step
        function simulationStep() {
            state.simulationTime++;
            
            // Execute processes
            executeProcesses();
            
            // Allocate resources
            allocateResources();
            
            // Update metrics and UI
            updateMetrics();
            updateUI();
            updateChartsData();
            
            // Check for completion
            if (state.processes.every(p => p.status === 'completed')) {
                pauseSimulation();
                addLog('All processes completed! Simulation finished.', 'success');
            }
        }

        // Execute Processes
        function executeProcesses() {
            state.processes.forEach(process => {
                if (process.status === 'running') {
                    process.remainingTime--;
                    
                    if (process.remainingTime <= 0) {
                        process.status = 'completed';
                        process.completionTime = state.simulationTime;
                        state.metrics.completedProcesses++;
                        
                        // Free resources
                        state.resources.allocatedCPU -= process.cpuAllocated;
                        state.resources.allocatedMemory -= process.memoryAllocated;
                        state.resources.allocatedIO -= process.ioAllocated;
                        
                        addLog(`Process ${process.id} (${process.name}) completed`, 'info');
                    }
                } else if (process.status === 'waiting') {
                    process.waitTime++;
                    state.metrics.totalWaitTime++;
                }
            });
        }

        // Adaptive Resource Allocation Algorithm
        function allocateResources() {
            const algorithm = elements.algorithm.value;
            
            // Free resources from completed processes
            const completedProcesses = state.processes.filter(p => p.status === 'completed');
            completedProcesses.forEach(process => {
                process.cpuAllocated = 0;
                process.memoryAllocated = 0;
                process.ioAllocated = 0;
            });
            
            // Get waiting processes
            const waitingProcesses = state.processes.filter(p => p.status === 'waiting');
            
            // Sort based on algorithm
            switch (algorithm) {
                case 'priority':
                    waitingProcesses.sort((a, b) => b.priority - a.priority);
                    break;
                case 'roundrobin':
                    // Simple round robin: rotate based on arrival time
                    waitingProcesses.sort((a, b) => a.arrivalTime - b.arrivalTime);
                    break;
                case 'fcfs':
                    waitingProcesses.sort((a, b) => a.arrivalTime - b.arrivalTime);
                    break;
                case 'multilevel':
                    // Multilevel: priority first, then FCFS within same priority
                    waitingProcesses.sort((a, b) => {
                        if (b.priority !== a.priority) return b.priority - a.priority;
                        return a.arrivalTime - b.arrivalTime;
                    });
                    break;
                default: // adaptive
                    waitingProcesses.sort((a, b) => {
                        // Adaptive algorithm: priority + wait time + resource efficiency
                        const scoreA = (b.priority * 2) + (b.waitTime * 0.5) - (b.cpuNeed + b.memoryNeed/100);
                        const scoreB = (a.priority * 2) + (a.waitTime * 0.5) - (a.cpuNeed + a.memoryNeed/100);
                        return scoreB - scoreA;
                    });
            }
            
            // Allocate resources to waiting processes
            waitingProcesses.forEach(process => {
                const cpuAvailable = state.resources.cpu - state.resources.allocatedCPU;
                const memoryAvailable = state.resources.memory - state.resources.allocatedMemory;
                const ioAvailable = state.resources.io - state.resources.allocatedIO;
                
                if (process.cpuNeed <= cpuAvailable &&
                    process.memoryNeed <= memoryAvailable &&
                    process.ioNeed <= ioAvailable) {
                    
                    process.cpuAllocated = process.cpuNeed;
                    process.memoryAllocated = process.memoryNeed;
                    process.ioAllocated = process.ioNeed;
                    process.status = 'running';
                    
                    state.resources.allocatedCPU += process.cpuNeed;
                    state.resources.allocatedMemory += process.memoryNeed;
                    state.resources.allocatedIO += process.ioNeed;
                    
                    state.metrics.contextSwitches++;
                    addLog(`Process ${process.id} allocated resources`, 'success');
                }
            });
        }

        // Update Metrics
        function updateMetrics() {
            // Update history
            const cpuUsage = (state.resources.allocatedCPU / state.resources.cpu) * 100;
            const memoryUsage = (state.resources.allocatedMemory / state.resources.memory) * 100;
            const ioUsage = (state.resources.allocatedIO / state.resources.io) * 100;
            
            state.history.cpu.push(cpuUsage);
            state.history.memory.push(memoryUsage);
            state.history.io.push(ioUsage);
            state.history.processCount.push(state.processes.length);
            
            // Keep history size limited
            if (state.history.cpu.length > state.maxHistoryPoints) {
                state.history.cpu.shift();
                state.history.memory.shift();
                state.history.io.shift();
                state.history.processCount.shift();
            }
        }

        // Update UI
        function updateUI() {
            // Update resource bars
            const cpuUsage = (state.resources.allocatedCPU / state.resources.cpu) * 100;
            const memoryUsage = (state.resources.allocatedMemory / state.resources.memory) * 100;
            const ioUsage = (state.resources.allocatedIO / state.resources.io) * 100;
            
            elements.cpuPercent.textContent = cpuUsage.toFixed(1) + '%';
            elements.memoryPercent.textContent = memoryUsage.toFixed(1) + '%';
            elements.ioPercent.textContent = ioUsage.toFixed(1) + '%';
            
            elements.cpuBar.style.width = cpuUsage + '%';
            elements.memoryBar.style.width = memoryUsage + '%';
            elements.ioBar.style.width = ioUsage + '%';
            
            // Update header stats
            elements.totalProcesses.textContent = state.processes.length;
            elements.cpuUtil.textContent = cpuUsage.toFixed(1) + '%';
            elements.simulationTime.textContent = state.simulationTime + 's';
            
            // Update metrics
            const throughput = state.metrics.completedProcesses;
            const avgWaitTime = state.processes.length > 0 ? 
                (state.metrics.totalWaitTime / state.processes.length).toFixed(1) : '0';
            
            elements.throughput.textContent = throughput;
            elements.avgWait.textContent = avgWaitTime + 's';
            
            // Update process grid
            updateProcessGrid();
            
            // Update table
            updateTable();
        }

        // Update Process Grid
        function updateProcessGrid() {
            elements.processGrid.innerHTML = '';
            
            state.processes.forEach(process => {
                const card = document.createElement('div');
                card.className = `process-card ${process.status}`;
                
                const statusClass = `status-${process.status}`;
                const progress = ((process.burstTime - process.remainingTime) / process.burstTime) * 100;
                
                card.innerHTML = `
                    <div class="process-header">
                        <div class="process-name">
                            <i class="fas ${process.icon}" style="color: ${process.color}; margin-right: 8px;"></i>
                            ${process.name}
                        </div>
                        <span class="process-status ${statusClass}">${process.status.toUpperCase()}</span>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #666;">
                        <div>PID: ${process.id} | Priority: ${process.priority}</div>
                        <div>Type: ${process.type}</div>
                    </div>
                    <div class="process-resources">
                        <div class="resource-item">
                            <div class="resource-label">CPU</div>
                            <div class="resource-value">${process.cpuAllocated}/${process.cpuNeed}</div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-label">Memory</div>
                            <div class="resource-value">${process.memoryAllocated}MB</div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-label">I/O</div>
                            <div class="resource-value">${process.ioAllocated}</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px;">
                            <span>Progress</span>
                            <span>${process.remainingTime}s remaining</span>
                        </div>
                        <div style="height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                            <div style="width: ${progress}%; height: 100%; background: ${process.color}; border-radius: 3px;"></div>
                        </div>
                    </div>
                `;
                
                elements.processGrid.appendChild(card);
            });
        }

        // Update Table
        function updateTable() {
            elements.tableBody.innerHTML = '';
            
            state.processes.forEach(process => {
                const row = document.createElement('tr');
                
                const statusClass = process.status === 'running' ? 'status-running' :
                                  process.status === 'waiting' ? 'status-waiting' : 'status-completed';
                
                row.innerHTML = `
                    <td>${process.id}</td>
                    <td><i class="fas ${process.icon}" style="color: ${process.color}; margin-right: 5px;"></i> ${process.name}</td>
                    <td>${process.type}</td>
                    <td><span class="process-status ${statusClass}">${process.status.toUpperCase()}</span></td>
                    <td>${process.priority}</td>
                    <td>${process.cpuAllocated}/${process.cpuNeed}</td>
                    <td>${process.memoryAllocated}MB/${process.memoryNeed}MB</td>
                    <td>${process.ioAllocated}/${process.ioNeed}</td>
                    <td>${process.waitTime}s</td>
                    <td>${process.remainingTime}s</td>
                `;
                
                elements.tableBody.appendChild(row);
            });
        }

        // Update Charts Data
        function updateChartsData() {
            // Update line charts
            state.charts.cpu.data.datasets[0].data = state.history.cpu;
            state.charts.memory.data.datasets[0].data = state.history.memory;
            state.charts.io.data.datasets[0].data = state.history.io;
            
            // Update process status chart
            const running = state.processes.filter(p => p.status === 'running').length;
            const waiting = state.processes.filter(p => p.status === 'waiting').length;
            const completed = state.processes.filter(p => p.status === 'completed').length;
            
            state.charts.process.data.datasets[0].data = [running, waiting, completed];
            
            // Update all charts
            state.charts.cpu.update();
            state.charts.memory.update();
            state.charts.io.update();
            state.charts.process.update();
        }

        // Add Log Entry
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            const timeStr = state.simulationTime.toString().padStart(3, '0');
            logEntry.innerHTML = `
                <span class="log-time">[${timeStr}s]</span> 
                <i class="fas ${type === 'info' ? 'fa-info-circle' : 
                              type === 'success' ? 'fa-check-circle' : 
                              type === 'warning' ? 'fa-exclamation-triangle' : 
                              'fa-exclamation-circle'}"></i>
                ${message}
            `;
            
            elements.systemLog.appendChild(logEntry);
            elements.systemLog.scrollTop = elements.systemLog.scrollHeight;
            
            // Keep log size manageable
            if (elements.systemLog.children.length > 50) {
                elements.systemLog.removeChild(elements.systemLog.firstChild);
            }
        }

        // Add New Process
        function addNewProcess() {
            if (state.processes.length >= 20) {
                addLog('Maximum process limit reached (20)', 'warning');
                return;
            }
            
            const newProcess = createRandomProcess();
            state.processes.push(newProcess);
            addLog(`New process added: ${newProcess.name}`, 'info');
            updateUI();
        }

        // Event Listeners
        function setupEventListeners() {
            // Control buttons
            elements.startBtn.addEventListener('click', startSimulation);
            elements.pauseBtn.addEventListener('click', pauseSimulation);
            elements.resetBtn.addEventListener('click', initSimulation);
            elements.addProcessBtn.addEventListener('click', addNewProcess);
            
            // Range inputs
            elements.processCount.addEventListener('input', (e) => {
                elements.processValue.textContent = e.target.value;
                if (!state.isRunning) {
                    initSimulation();
                }
            });
            
            elements.cpuCount.addEventListener('input', (e) => {
                elements.cpuValue.textContent = e.target.value;
                if (!state.isRunning) {
                    initSimulation();
                }
            });
            
            elements.memorySize.addEventListener('input', (e) => {
                elements.memoryValue.textContent = e.target.value;
                if (!state.isRunning) {
                    initSimulation();
                }
            });
            
            elements.ioDevices.addEventListener('input', (e) => {
                elements.ioValue.textContent = e.target.value;
                if (!state.isRunning) {
                    initSimulation();
                }
            });
            
            // Algorithm change
            elements.algorithm.addEventListener('change', () => {
                addLog(`Algorithm changed to: ${elements.algorithm.options[elements.algorithm.selectedIndex].text}`, 'info');
            });
        }

        // Initialize Application
        function initApp() {
            initCharts();
            initSimulation();
            setupEventListeners();
            
            // Initial log message
            addLog('Adaptive Resource Allocation System initialized', 'info');
            addLog('Configure parameters and click Start to begin simulation', 'info');
            addLog('System ready with ' + elements.processCount.value + ' initial processes', 'success');
            
            // Disable pause button initially
            elements.pauseBtn.disabled = true;
        }

        // Start application when page loads
        window.addEventListener('load', initApp);

        // Expose functions for debugging (optional)
        window.simulation = {
            state,
            startSimulation,
            pauseSimulation,
            initSimulation,
            addNewProcess
        };
    </script>
</body>
</html>